{"title":"Analysis of experimental data","markdown":{"headingText":"Analysis of experimental data","containsRefs":false,"markdown":"```{r, include=F, warning=F, message=F}\nlibrary(tidyverse); library(here); library(ggthemes)\nlibrary(viridis); library(tidybayes); library(wesanderson)\nlibrary(ggdist); library(patchwork); library(extrafont)\nlibrary(parallel); library(deSolve); library(tmvtnorm)\nlibrary(fdrtool); library(readxl); library(here); library(easystats)\nlibrary(RColorBrewer); library(devtools); library(car); library(plotly)\nlibrary(knitr); library(Hmisc); library(nlstools); library(lsmeans)\nlibrary(ggpubr); library(gridExtra) ; library(grid);\nlibrary(modelsummary);\nlibrary(plan); library(brms); library(ggmcmc); library(latex2exp);\nlibrary(reshape2); library(ggbreak); library(nord); library(ggtext); \nlibrary(kableExtra); library(DT); library(grid);\nlibrary(rstan); library(cmdstanr)\n\nsizetitle <- 12\n\nNord_frost <- nord(palette = \"frost\")\nNord_polar <- nord(palette = \"polarnight\")\n\ncol_blue <- \"#5E81AC\"\ncol_red <- \"#f42404\"\npal_col <- c(col_blue, col_red)\n\npal_blue <- c(\"#5E81AC\", \"#7F9DC4\", \"#A0C1D9\", \"#DCE9F2\")\npal_red <- c(\"#f42404\", \"#F65E4B\", \"#F6876D\", \"#FBD3D0\")  \n```\n\n\nThe model is now fitted on our experimental data.\n\n## Data used\n\n```{r datagrowth, warning=F, message=F}\n#| code-fold: show\n\ndf_growth <- read_excel(here::here(\"data/Data_growth_EPX_DMX.xlsx\"), sheet=\"Growth\") # <1>\n\ndead <- subset(df_growth, t==14 & status == \"D\")$ID                                  # <2>\n\ndf_growth <- df_growth |> \n  subset(t<57 & (!ID %in% dead)) |>                                                  # <3>\n  mutate(\n    L            = w^(1/3),                                                          # <4>\n    exposition   = as.factor(0 + 1*(exposition == \"Trt\")),                           # <5>\n    ID           = as.factor(ID)\n    )\n\ndf_growth_mean <- df_growth |>                                                       # <6>\n  aggregate(w ~ t + exposition, mean)                                                # <6>\n\nn_ctrl <- length(subset(df_growth, t==0 & exposition == 0)$ID)                       # <7>\nn_trt <- length(subset(df_growth, t==0 & exposition == 1)$ID)                        # <7>\n\n```\n\n1.  Raw data importation\n2.  Individuals that died before day 56\n3.  Dataset of the first 56 days without the dead individuals\n4.  Structural length calculation (mg$^{1/3}$/d)\n5.  Creation of a new exposition variable for the sake of short model parameters' names\n6.  Creation of a dataset with the mean growth per exposition group\n7.  Number of individuals in each group\n\n```{r, warning=F, message=F}\n#| fig-cap: Evolution of fresh body weight of non-exposed earthworms (blue points and thin lines, each line corresponding to one individual) and earthworms exposed to the equivalent of 3 RD of SwingÂ® Gold renewed each 28 days (red points and thin lines, each line corresponding to one individual).\n#| label: fig-growthdataset2\n#| fig-width: 6\n#| fig-height: 4\n\nalpha_point <- 0.5\nalpha_line <- 0.3\n\np_growth <- ggplot(\n  data=df_growth, \n  aes(\n    x=t, \n    y=w, \n    color=exposition, \n    group=ID\n    )\n  ) +\n  \n  geom_line(\n    lwd=0.8, \n    alpha=alpha_line, \n    color = \"grey80\"\n    ) +\n  geom_point(\n    alpha=alpha_point, \n    size=2\n    ) +\n  facet_wrap(~exposition) +\n  \n  scale_color_manual(\n    values = pal_col, \n    label  = c(\"Non exposed\", \"Exposed\"), \n    name   = \"\"\n    ) +\n  \n  labs(\n    x         = \"Time (days)\", \n    y         = \"Weight (mg)\",\n    title     = \"Growth monitoring\",\n    subtitle  = \"For the <span style = 'color:#5E81AC;'>non exposed</span> \n       and <span style = 'color:#f42404;'>exposed</span> groups\"\n    )+\n  \n  scale_x_continuous(\n    limits = c(0, 56),        \n    breaks = seq(0, 56, by = 28),        \n    minor_breaks = seq(0, 56, by = 14)\n  ) +\n  \n  theme_minimal(12)+\n  theme(\n    legend.position = \"none\",\n        \n    title=element_markdown(face=\"bold\"),\n    plot.subtitle=element_markdown(face=\"plain\"),\n        \n    axis.title=element_text(face=\"plain\"),\n        \n    strip.background = element_blank(),\n    strip.text = element_blank()\n    )\n\np_growth\n\n```\n\nComparison of the initial state in both cohorts :\n\n```{r vartestt0}\ndf_growth_t0 <- subset(df_growth, t==0)  # <1>\n\n# Equality of variances\nvar.test(                                # <2>\n  subset(df_growth_t0, exposition==0)$w, # <2>\n  subset(df_growth_t0, exposition==1)$w  # <2>\n  )                                      # <2>\n```\n\n1.  Dataset for t=0.\n2.  Equality of weight variance test between the two groups.\n\nThe datasets are not inconsistent with a ratio of variances equal to 1.\n\n```{r ttestt0}\n# Equality of means\nt.test(df_growth_t0$w~df_growth_t0$exposition, var.equal=T)\n```\n\nWe can conclude there is no effect of the cohort on the initial weight of the individuals.\n\n## Model prior definition {#sec-modeldef}\n\n```{r moddef}\n#| code-fold: show\n\n# Model definition\nbf.mod.VI <- \n  \n  bf(\n    L  ~ L0+a*t,                            # <1> \n    L0 ~ 1 + (1||ID),                       # <2>\n    a  ~ 0 + exposition+(0+exposition||ID), # <3>\n    \n    center=T,                               # <4>\n    nl=T                                    # <5>\n  )                              \n\n```\n\n1.  Equation of L depending on t\n2.  Each individual can have its own L0 value but L0 does not depend on the exposition\n3.  Each individual can have its own a value and a depend on the exposition\n4.  Data are centered in the calculation process\n5.  Our parameters have non-linear definitions\n\n```{r modparamlist}\nList_parameters <- \n  \n  c(\n    \"b_L0_Intercept\",       # L0_mu\n    \"sd_ID__L0_Intercept\",  # L0_sd\n    \"b_a_exposition0\",      # a_ctrl_mu\n    \"b_a_exposition1\",      # a_trt_mu\n    \"sd_ID__a_exposition0\", # a_ctrl_sd\n    \"sd_ID__a_exposition1\", # a_trt_sd\n    \"sigma\"                 # Residuals variance\n  )\n```\n\nThe model parameters are named as follows by `brms` :\n\n-   $L0_{\\mu}$ : `b_L0_Intercept`\n-   $L0_{\\sigma}$ : `sd_ID__L0_Intercept`\n-   $a_{\\text{ctrl},\\mu}$ : `b_a_exposition0`\n-   $a_{\\text{trt},\\mu}$ : `b_a_exposition1`\n-   $a_{\\text{ctrl},\\sigma}$ : `sd_ID__a_exposition0`\n-   $a_{\\text{trt},\\sigma}$ : `sd_ID__a_exposition1`\n\n## Priors definition\n\nThe priors were defined according to the results of @bart_2020a considering the studied non-exposed individuals. The same priors are given to the two cohorts. A growth rate individual variation of 20% was given as a prior for the two cohort.\n\n!!!!!!!!!!! JUSTIF CHOIX PRIORS !!!!!!!!!!!!!!!!!!!!!!!!!!\n\n```{r prior}\n#| code-fold: show\n\n# Priors definition\npriors <- \n  prior(normal(2.25, 0.45), class = b, nlpar = L0, lb = 0) +          # <1>\n  prior(normal(2.25*0.2, 2.25*0.2), class = sd, nlpar = L0)+          # <2> \n\n  prior(normal(0.075, 0.015), class=b, coef=exposition0, nlpar = a) + # <3>\n  prior(normal(0.075, 0.015), class=b, coef=exposition1, nlpar = a) + # <4>\n\n  prior(normal(0.075*0.2, 0.075*0.2), class=sd,                       # <5>\n        coef=exposition0, group=ID, nlpar = a)+                       # <5>\n  prior(normal(0.075*0.2, 0.075*0.2), class=sd,                       # <6>\n        coef=exposition1, group=ID, nlpar = a)+                       # <6>\n\n  prior(exponential(1), sigma)                                        # <7>\n\n```\n\n1.  Prior on $L0_{\\mu}$\n2.  Prior on $L0_{\\sigma}$\n3.  Prior on $a_{\\text{ctrl},\\mu}$\n4.  Prior on $a_{\\text{trt},\\mu}$\n5.  Prior on $a_{\\text{ctrl},\\sigma}$\n6.  Prior on $a_{\\text{trt},\\sigma}$\n7.  Prior on residuals\n\n```{r}\n#| fig-cap: Priors of our model.\n#| label: fig-priorplot\n#| fig-height: 12\n#| fig-width: 12\n\ncol_dens <- Nord_polar[1]\nalpha_dens <- 0.5\nsizetitle <- 18\n\npriors$nlpar <- factor(priors$nlpar, levels = c(\"L0\", \"a\")) \n\n\np1 <- priors %>% \n  parse_dist() %>% \n  filter(class == \"b\") %>% \n  ggplot(\n    aes(\n      xdist = .dist_obj, \n      y = format(.dist_obj),\n      color = coef,\n      fill = coef\n      )\n    ) +\n  stat_dist_halfeye(\n    alpha = alpha_dens\n  ) +\n  facet_wrap(\n    ~nlpar+coef, \n    scales = \"free\"\n    ) +\n  scale_color_manual(values = c(Nord_polar[4], Nord_frost[4], col_red))+\n  scale_fill_manual(values = c(Nord_polar[4], Nord_frost[4], col_red))+\n  ggtitle(\"Intercepts\") +\n  labs(\n    x = \"Value\",\n    y = \"Density\"\n    )+\n  theme_minimal()+\n  theme(\n    axis.text.y = element_text(angle = 90),\n    plot.title = element_text(face=\"bold\", size = sizetitle),\n    strip.text = element_text(face=\"plain\", size = sizetitle-2),\n        )\n\np2 <- priors %>% \n  parse_dist() %>% \n  filter(class == \"sd\") %>% \n  ggplot(\n    aes(\n      xdist = .dist_obj, \n      y = format(.dist_obj),\n      color = coef,\n      fill = coef\n      )\n    ) +\n  stat_dist_halfeye(\n    alpha = alpha_dens\n  ) +\n  facet_wrap(\n    ~nlpar+coef, \n    scales = \"free\"\n    ) +\n  scale_color_manual(values = c(Nord_polar[4], Nord_frost[4], col_red))+\n  scale_fill_manual(values = c(Nord_polar[4], Nord_frost[4], col_red))+\n  ggtitle(\"Inter-individual variances\") +\n  labs(\n    x = \"Value\",\n    y = \"Density\"\n    )+\n  theme_minimal()+\n  theme(\n    axis.text.y = element_text(angle = 90),\n    plot.title = element_text(face=\"bold\", size = sizetitle),\n    strip.text = element_text(face=\"plain\", size = sizetitle-2),\n    )\n\np3 <- priors %>% \n  parse_dist() %>% \n  filter(class == \"sigma\") %>% \n  ggplot(\n    aes(\n      xdist = .dist_obj, \n      y = format(.dist_obj),\n      color = coef,\n      fill = coef\n      )\n    ) +\n  stat_dist_halfeye(\n    alpha = alpha_dens\n  ) +\n  facet_wrap(\n    ~nlpar, \n    scales = \"free\"\n    ) +\n  scale_color_manual(values = c(Nord_polar[4], Nord_frost[4], col_red))+\n  scale_fill_manual(values = c(Nord_polar[4], Nord_frost[4], col_red))+\n  ggtitle(\"Residual variance\") +\n  labs(\n    x = \"Value\",\n    y = \"Density\"\n    )+\n  theme_minimal()+\n  theme(\n    axis.text.y = element_text(angle = 90),\n    plot.title = element_text(face=\"bold\", size = sizetitle),\n    strip.text = element_text(face=\"plain\", size = sizetitle-2),\n    )\n\np <- p1 + p2 + p3 + \n  plot_layout(ncol = 1)&\n  theme(legend.position = \"none\")\np\n```\n\n```{r savepriorsplot, include=F, message=F, warning=F}\nggsave(\n  filename=\"ModVI_priors.png\", \n  plot=p, \n  width=8, height = 10, \n  path=here::here(\"fig/\")\n  )\n\nggsave(\n  filename=\"ModVI_priors.svg\", \n  plot=p, \n  width=8, height = 10, \n  path=here::here(\"fig/\")\n  )\n```\n\n## Prior predictive check\n\nIn bayesian modeling, we first perform a prior predictive check before fitting the model to our data. This allows us to check on the rationnality of the chosen priors.\n\nResults of the model with the sampling of priors :\n\n```{r, warning=F, message=F}\n\nm.1.VI.prior <- \n  \n  brm(\n    data = df_growth,                   # <1>\n    bf.mod.VI,                          # <2>\n    backend = \"cmdstanr\",               # <3>\n    prior = priors,                     # <4>\n    sample_prior = \"only\",              # <5>\n    cores = 4,                          # <6>\n    seed = 42,                          # <7>\n    iter = 1000, warmup = 500,          # <8>\n    control = list(\n      adapt_delta = .95,                # <9>\n      max_treedepth = 12                # <9>\n      ), \n    file=here::here(\"mod/m_brms_VI_prior\")   # <10>\n  )\n\nprint(m.1.VI.prior)\n\n```\n\n1.  Data used\n2.  Model to be used\n3.  Type of backend for calculations\n4.  Priors to be used\n5.  Work only done with priors and not the data\n6.  Cores for calculations\n7.  Seed for reproducibility\n8.  A total of 1000 interations are done with 500 that are part of the warmup phase\n9.  Control parameters on the iterations\n10. Path where the model results are saved\n\nWe can then plot the predictions of this model and see if they represent at least the full range of our experimental data.\n\n```{r, echo = T, warning=F}\n#| fig-cap: Prior predictive check.\n#| label: fig-priorpredVI\n#| fig-height: 4\n#| fig-width: 8\n\npred <- predicted_draws(m.1.VI.prior, newdata=df_growth) # <1> \n\ny_max <- 480\n\np_ctrl <- ggplot()+\n  \n  stat_lineribbon(\n    data = pred[pred$exposition == 0,], \n    aes(x = t, y = .prediction^3, group = exposition),\n    .width=c(.99,.95,.8,.5),\n    color=\"black\"\n    )+\n  geom_line(\n    data = df_growth[df_growth$exposition==0,],\n    aes(x = t, y = L^3, group=ID),\n    color = \"black\",\n    alpha = 0.4\n    )+\n  geom_point(\n    data = df_growth[df_growth$exposition==0,],\n    aes(x = t, y = L^3, group = ID),\n    color = \"black\",\n    alpha = 0.4\n    )+\n  \n  scale_fill_manual(values = rev(pal_blue))+\n  \n  labs(y=\"Weight (mg)\", x=\"Time (days)\")+\n  \n  ylim(0, y_max)+\n  \n  scale_x_continuous(\n    limits = c(0, 56),        \n    breaks = seq(0, 56, by = 28),        \n    minor_breaks = seq(0, 56, by = 14)\n  ) +\n  \n  theme_minimal()+\n  theme(legend.position = \"none\")\n\n\np_trt <- ggplot()+\n  \n  stat_lineribbon(\n    data = pred[pred$exposition==1,],\n    aes(x = t, y=.prediction^3, group=exposition),\n    .width=c(.99,.95,.8,.5),\n    color=\"black\"\n    )+\n  geom_point(\n    data = df_growth[df_growth$exposition==1,],\n    aes(x = t, y = L^3, group = ID),\n    color = \"black\",\n    alpha = 0.4\n    )+\n  geom_line(\n    data = df_growth[df_growth$exposition==1,],\n    aes(x = t, y = L^3, group = ID),\n    color = \"black\",\n    alpha = 0.4\n    )+\n  \n  scale_fill_manual(values = rev(pal_red))+\n  \n  labs(y=\"Weight (mg)\", x=\"Time (days)\")+\n  \n  ylim(0, y_max)+\n  scale_x_continuous(\n    limits = c(0, 56),        \n    breaks = seq(0, 56, by = 28),        \n    minor_breaks = seq(0, 56, by = 14)\n  ) +\n  \n  theme_minimal(14)+\n  theme(legend.position = \"none\")\n\nplot.prior_pred <- p_ctrl + p_trt + \n  plot_layout(ncol = 2, guides = \"collect\") & \n  theme(\n    legend.position = \"right\", \n    title=element_text(face=\"bold\"), \n    axis.title.x = element_text(face=\"plain\"),\n    axis.title.y = element_text(face=\"plain\")\n    )\n\nplot.prior_pred\n```\n\n1.  Predictions from the model\n\nThe @fig-priorpredVI shows the chosen priors are realistic.\n\n## Posterior predictive check\n\n### Model fit\n\nWe can now fit the model to our experimental data.\n\n```{r, warning=F, message=F}\n#| code-fold: show\n\nm.1.VI.post <- \n  \n  brm(\n    data = df_growth,                              # <1>\n    bf.mod.VI,                                     # <2>\n    backend = \"cmdstanr\",                          # <3>\n    prior = priors,                                # <4>\n    save_pars = save_pars(all = TRUE),             # <5>\n    sample_prior = \"yes\",                          # <6>\n    seed = 42,                                     # <7>\n    chains = 4, cores = 4,                         # <8>\n    iter = 6000, warmup = 1000,                    # <9>\n    control = list(adapt_delta = .95,              # <10>\n    max_treedepth = 12),                           # <10>\n    file=here::here(\"mod/m_brms_VI_post\")   # <11>\n  )\n\nprint(m.1.VI.post)\n\n```\n\n1.  Data used\n2.  Model to be used\n3.  Type of backend for calculations\n4.  Priors to be used\n5.  We want all parameters to be saved\n6.  Work done with priors and the data\n7.  Number of chains and cores for calculations\n8.  Seed for reproducibility\n9.  A total of 6000 interations are done with 1000 that are part of the warmup phase\n10. Control parameters on the iterations\n11. Path where the model results are saved\n\n### Parameter estimation results\n\nChains recuperation and calculation of additional parameters :\n\n```{r chainspost, warning=F, message=F}\n                                             \ndf_chains <- ggs(m.1.VI.post, burnin = T) |>                    # <1>\n  filter(Parameter %in% List_parameters) |>                     # <1>\n  mutate(                                                       # <1>\n    Chain=as.factor(Chain),                                     # <1>\n    value=value                                                 # <1>\n    )                                                           # <1>\n                                             \ndf_chains_post <- df_chains |>                                  # <2>\n  filter(Iteration>1000)                                        # <2>\n\ndf_chains_median <- df_chains_post |>                           # <3>\n  aggregate(value ~ Parameter, median) |>                       # <3>\n  rename(median = value)                                        # <3>\n\nParam_a_mu <- c(\n  \"b_a_exposition0\", \n  \"b_a_exposition1\"\n  )\nParam_a_sd <- c(\n  \"sd_ID__a_exposition0\", \n  \"sd_ID__a_exposition1\"\n  )\nParam_ctrl <- c(\n  \"b_a_exposition0\", \n  \"sd_ID__a_exposition0\"\n  )\nParam_trt <- c(\n  \"b_a_exposition1\", \n  \"sd_ID__a_exposition1\"\n  )\nParam_t0 <- c(\n  \"b_L0_Intercept\",\n  \"sd_ID__L0_Intercept\", \n  \"Delta_a_mu\", \n  \"Delta_a_sd\",\n  \"sigma\"\n  )\n\ndf_chains_post_large <-                        # <4>\n  dcast(                                       # <4>\n    data = df_chains_post,                     # <4>\n    formula = Iteration + Chain ~ Parameter,   # <4>\n    value.var = 'value'                        # <4>\n  )                                            # <4>\n\ndf_chains_post_large <- df_chains_post_large |>                 # <4>\n  mutate(                                                       # <4>\n    Delta_a_mu = b_a_exposition1-b_a_exposition0,               # <4>\n    Ratio_a_mu = b_a_exposition1/b_a_exposition0,               # <4>\n    Delta_a_sd = sd_ID__a_exposition1-sd_ID__a_exposition0,     # <4>\n    Ratio_a_sd = sd_ID__a_exposition1/sd_ID__a_exposition0,     # <4>\n    LnRR = log(b_a_exposition1/b_a_exposition0),                 # <4>\n    LnCVR = log((sd_ID__a_exposition1/b_a_exposition1)/(sd_ID__a_exposition0/b_a_exposition0))                    # <4>\n  )\n\ndf_chains_post_long <- df_chains_post_large |>                  # <4>\n  melt(                                                         # <4>\n    id.vars=c(\"Iteration\", \"Chain\"),                            # <4>\n    measure.vars=colnames(df_chains_post_large)[-c(1,2)],       # <4>\n    variable.name=\"Parameter\",                                  # <4>\n    value.name=\"value\"                                          # <4>\n  )                                                             # <4>\n\n\ndf_chains_post_long <- df_chains_post_long |> \n  mutate(\n    exposition = case_when(\n      Parameter %in% Param_ctrl ~ \"Non exposed\",\n      Parameter %in% Param_trt ~ \"Exposed\",\n      Parameter %in% Param_t0 ~ \"General\")\n    )\n\n```\n\n1.  Extraction of each chain iterations values for each parameters\n2.  Only iterations after the warmup phase\n3.  Adding medians from each distribution\n4.  Calculation and addition of 2 columns: $\\Delta a_{\\mu} = a_{\\text{trt},\\mu} - a_{\\text{ctrl},\\mu}$ & $\\Delta a_{\\sigma} = a_{\\text{trt},\\sigma} - a_{\\text{ctrl},\\sigma}$\n\nThe results of the pesticides effect can be expressed with a response ratio (Ln(RR), @eq-LnRR) and a coefficient of variation ratio (Ln(CVi), @eq-LnCVi).\n\n$$\n\\text{Ln}(\\text{RR}) = \\text{Ln}\\left( \\frac{a_{ctrl,\\mu}}{a_{trt,\\mu}} \\right)\n$$ {#eq-LnRR}\n\n$$\n\\text{Ln}(\\text{CVi}) = \\text{Ln}\\left( \\frac{CV_{ctrl}}{CV_{trt}} \\right) - \\frac{1}{2(n_{trt}-1)}-\\frac{1}{2(n_{ctrl}-1)}\\\\\n$$ {#eq-LnCVi}\n\nWith :\n\n$$\nCV_{x}=\\frac{a_{x,\\sigma}}{a_{x,\\mu}}\n$$\n\nParameters estimation results :\n\n```{r, warning=F}\n#| fig-cap: Prior (light grey) and posterior distributions for each parameter.\n#| label: fig-priorpost\n#| fig-height: 12\n#| fig-width: 12\n\nalpha_dens <- 0.5\nalpha_dens_prior <- 0.2\nfont_size <- 12\ncol_dens <- Nord_polar[1]\ncol_dens_ctrl <- Nord_frost[4]\ncol_dens_trt <- col_red\nsize_norm <- 0.7\n\nprior_L0_mu <- priors %>% \n  parse_dist() %>% \n  filter(class == \"b\" & nlpar == \"L0\")\nprior_L0_sd <- priors %>% \n  parse_dist() %>% \n  filter(class == \"sd\" & nlpar == \"L0\")\n\nprior_a_ctrl_mu <- priors %>% \n  parse_dist() %>% \n  filter(class == \"b\" & nlpar == \"a\" & coef == \"exposition0\")\nprior_a_ctrl_sd <- priors %>% \n  parse_dist() %>% \n  filter(class == \"sd\" & nlpar == \"a\" & coef == \"exposition0\")\n\nprior_a_trt_mu <- priors %>% \n  parse_dist() %>% \n  filter(class == \"b\" & nlpar == \"a\" & coef == \"exposition1\")\nprior_a_trt_sd <- priors %>% \n  parse_dist() %>% \n  filter(class == \"sd\" & nlpar == \"a\" & coef == \"exposition1\")\n\nprior_sigma <- priors %>% \n  parse_dist() %>% \n  filter(class == \"sigma\")\n\nplot_L0_mu <-\n  ggplot() +\n  stat_dist_halfeye(\n    data = prior_L0_mu,\n    aes(\n      xdist = .dist_obj\n      ),\n    fill = col_dens,\n    color = col_dens,\n    alpha = alpha_dens_prior\n  ) +\n  stat_halfeye(\n    data = subset(df_chains_post_long,Parameter == \"b_L0_Intercept\"),\n    mapping = aes(\n      x=value,\n    ),\n    fill = col_dens,\n    color = col_dens,\n    alpha = alpha_dens\n  ) +\n  labs(\n    x = \"Value\",\n    y = \"Density\",\n    title = bquote(bold(\"Mean initial structural length \" (mg^{1/3})))\n    )+\n  theme_minimal()+\n  theme(\n    axis.text.y = element_text(angle = 90),\n    plot.title = element_text(face = \"bold\")\n        )\n\nplot_L0_sd <-\n  ggplot() +\n  stat_dist_halfeye(\n    data = prior_L0_sd,\n    aes(\n      xdist = .dist_obj\n      ),\n    fill = col_dens,\n    color = col_dens,\n    alpha = alpha_dens_prior\n  ) +\n  stat_halfeye(\n    data = subset(df_chains_post_long,Parameter == \"sd_ID__L0_Intercept\"),\n    mapping = aes(\n      x=value,\n    ),\n    fill = col_dens,\n    color = col_dens,\n    alpha = alpha_dens\n  ) +\n  labs(\n    x = \"Value\",\n    y = \"Density\",\n    title = bquote(bold(\"Individual variation of\\ninitial structural length \" (mg^{1/3})))\n    )+\n  theme_minimal()+\n  theme(\n    axis.text.y = element_text(angle = 90),\n    plot.title = element_text(face = \"bold\")\n        )\n\nplot_a_ctrl_mu <-\n  ggplot() +\n  stat_dist_halfeye(\n    data = prior_a_ctrl_mu,\n    aes(\n      xdist = .dist_obj\n      ),\n    fill = col_dens,\n    color = col_dens,\n    alpha = alpha_dens_prior\n  ) +\n  stat_halfeye(\n    data = subset(df_chains_post_long,Parameter == \"b_a_exposition0\"),\n    mapping = aes(\n      x=value,\n    ),\n    fill = col_dens_ctrl,\n    color = col_dens_ctrl,\n    alpha = alpha_dens\n  ) +\n  labs(\n    x = \"Value\",\n    y = \"Density\",\n    title = bquote(bold(\"Mean growth rate \" (mg^{1/3}/d))),\n    subtitle = \"Non-exposed\"\n    )+\n  theme_minimal()+\n  theme(\n    axis.text.y = element_text(angle = 90),\n    plot.title = element_text(face = \"bold\")\n        )\n\nplot_a_trt_mu <-\n  ggplot() +\n  stat_dist_halfeye(\n    data = prior_a_trt_mu,\n    aes(\n      xdist = .dist_obj\n      ),\n    fill = col_dens,\n    color = col_dens,\n    alpha = alpha_dens_prior\n  ) +\n  stat_halfeye(\n    data = subset(df_chains_post_long,Parameter == \"b_a_exposition1\"),\n    mapping = aes(\n      x=value,\n    ),\n    fill = col_dens_trt,\n    color = col_dens_trt,\n    alpha = alpha_dens\n  ) +\n  labs(\n    x = \"Value\",\n    y = \"Density\",\n    title = bquote(bold(\"Mean growth rate \" (mg^{1/3}/d))),\n    subtitle = \"Exposed\"\n    )+\n  theme_minimal()+\n  theme(\n    axis.text.y = element_text(angle = 90),\n    plot.title = element_text(face = \"bold\")\n        )\n\nplot_a_ctrl_sd <-\n  ggplot() +\n  stat_dist_halfeye(\n    data = prior_a_ctrl_sd,\n    aes(\n      xdist = .dist_obj\n      ),\n    fill = col_dens,\n    color = col_dens,\n    alpha = alpha_dens_prior\n  ) +\n  stat_halfeye(\n    data = subset(df_chains_post_long,Parameter == \"sd_ID__a_exposition0\"),\n    mapping = aes(\n      x=value,\n    ),\n    fill = col_dens_ctrl,\n    color = col_dens_ctrl,\n    alpha = alpha_dens\n  ) +\n  labs(\n    x = \"Value\",\n    y = \"Density\",\n    title = bquote(bold(\"Inter-individual variation\\nof growth rate \" (mg^{1/3}/d))),\n    subtitle = \"Non-exposed\"\n    )+\n  theme_minimal()+\n  theme(\n    axis.text.y = element_text(angle = 90),\n    plot.title = element_text(face = \"bold\")\n        )\n\nplot_a_trt_sd <-\n  ggplot() +\n  stat_dist_halfeye(\n    data = prior_a_trt_sd,\n    aes(\n      xdist = .dist_obj\n      ),\n    fill = col_dens,\n    color = col_dens,\n    alpha = alpha_dens_prior\n  ) +\n  stat_halfeye(\n    data = subset(df_chains_post_long,Parameter == \"sd_ID__a_exposition1\"),\n    mapping = aes(\n      x=value,\n    ),\n    fill = col_dens_trt,\n    color = col_dens_trt,\n    alpha = alpha_dens\n  ) +\n  labs(\n    x = \"Value\",\n    y = \"Density\",\n    title = bquote(bold(\"Inter-individual variation\\nof growth rate \" (mg^{1/3}/d))),\n    subtitle = \"Exposed\"\n    )+\n  theme_minimal()+\n  theme(\n    axis.text.y = element_text(angle = 90),\n    plot.title = element_text(face = \"bold\")\n        )\n\nplot_sigma <-\n  ggplot() +\n  stat_dist_halfeye(\n    data = prior_sigma,\n    aes(\n      xdist = .dist_obj\n      ),\n    fill = col_dens,\n    color = col_dens,\n    alpha = alpha_dens_prior\n  ) +\n  stat_halfeye(\n    data = subset(df_chains_post_long,Parameter == \"sigma\"),\n    mapping = aes(\n      x=value,\n    ),\n    fill = col_dens,\n    color = col_dens,\n    alpha = alpha_dens\n  ) +\n  labs(\n    x = \"Value\",\n    y = \"Density\",\n    title = bquote(bold(\"Residual variance\" (mg^{1/3})))\n    )+\n  theme_minimal()+\n  theme(\n    axis.text.y = element_text(angle = 90),\n    plot.title = element_text(face = \"bold\")\n        )\n\n\np <- (plot_L0_mu+ plot_a_ctrl_mu + plot_a_trt_mu)/(plot_L0_sd + plot_a_ctrl_sd   + plot_a_trt_sd) / plot_sigma \np\n\n```\n\nThe fit on data gives information on model parameters as the posterior distributions are much more restrictive on parameter values than our priors.\n\n```{r tableres}\n#| tbl-cap: Comparaison  of the different statistical values of the posterior distributions\n#| label: tbl-compvalposttheoVI\n\ndf_res_VI <- summarise_draws(tidy_draws(m.1.VI.post))\n\ndf_res_VI_show <- df_res_VI[1:7,]\n\ndf_res_VI_show |> datatable(\n  options = list(\n    dom = 't',\n    columnDefs = list(\n      list(className = 'dt-left', targets = \"_all\")\n      )\n    ), \n  class=\"hover\"\n  ) |> \n  formatRound(columns = 2:length(df_res_VI_show), digits = 4)\n\n```\n\n```{r}\nratio_effet_mu <- abs(round((df_res_VI_show$median[3]-df_res_VI_show$median[2])/df_res_VI_show$median[2],2)*100)\naugmentation_effet_sd <- round(df_res_VI_show$median[6]/df_res_VI_show$median[5],2)\n\nper_ind_var_ctrl <- round(df_res_VI_show$median[5]/df_res_VI_show$median[2]*100, 2)\nper_ind_var_trt <- round(df_res_VI_show$median[6]/df_res_VI_show$median[3]*100, 2)\n```\n\nThe model estimations show a **reduction of `r ratio_effet_mu` % in the mean growth rate** but a **multiplication by `r augmentation_effet_sd` of the inter-individual variation of the growth rate**.\n\nThere are `r per_ind_var_ctrl` % of growth individual variation in the non-exposed group and `r per_ind_var_trt` % in the exposed group.\n\n```{r lnRRCVI}\n#| tbl-cap: Effect size results\n#| label: tbl-lnRRCVI\n\n# Calculation of the results for Ln(RR) and Ln(CVi)\n\nMedian_LnRR <- median(subset(df_chains_post_long, Parameter==\"LnRR\")$value)\nMedian_LnCVR <- median(subset(df_chains_post_long, Parameter==\"LnCVR\")$value)\nMedian_LnRR_print <- round(Median_LnRR, 2)\nMedian_LnCVR_print <- round(Median_LnCVR, 2)\n\nMedian_Ratio_a_mu <- median(subset(df_chains_post_long, Parameter==\"Ratio_a_mu\")$value)\nMedian_Ratio_a_sd <- median(subset(df_chains_post_long, Parameter==\"Ratio_a_sd\")$value)\n\nCI_Ratio_a_mu <- bayestestR::ci(subset(df_chains_post_long, Parameter==\"Ratio_a_mu\")$value, method = \"ETI\", ci = 0.90)\nCI_Ratio_a_mu_p <- paste(\"[\", round(CI_Ratio_a_mu$CI_low,2), \" ; \", round(CI_Ratio_a_mu$CI_high,2), \"]\", sep=\"\")\nCI_Ratio_a_sd <- bayestestR::ci(subset(df_chains_post_long, Parameter==\"Ratio_a_sd\")$value, method = \"ETI\", ci = 0.90)\nCI_Ratio_a_sd_p <- paste(\"[\", round(CI_Ratio_a_sd$CI_low,2), \" ; \", round(CI_Ratio_a_sd$CI_high,2), \"]\", sep=\"\")\n\nCI_LnRR <- bayestestR::ci(subset(df_chains_post_long, Parameter==\"LnRR\")$value, method = \"ETI\", ci = 0.90)\nCI_LnRR_p <- paste(\"[\", round(CI_LnRR$CI_low,2), \" ; \", round(CI_LnRR$CI_high,2), \"]\", sep=\"\")\n\nCI_LnCVR <- bayestestR::ci(subset(df_chains_post_long, Parameter==\"LnCVR\")$value, ci = 0.90)\nCI_LnCVR_p <- paste(\"[\", round(CI_LnCVR$CI_low,2), \" ; \", round(CI_LnCVR$CI_high,2), \"]\", sep=\"\")\n\npd_LnRR <- p_direction(subset(df_chains_post_long, Parameter==\"LnRR\")$value)\npd_LnCVR <- p_direction(subset(df_chains_post_long, Parameter==\"LnCVR\")$value)\n\npd_Ratio_a_mu <- p_direction(subset(df_chains_post_long, Parameter==\"Ratio_a_mu\")$value)\npd_Ratio_a_sd <- p_direction(subset(df_chains_post_long, Parameter==\"Ratio_a_sd\")$value)\n\ndf_res_Ln <- data.frame(\n  Variable = c(\"LnRR\", \"LnCVR\", \"Ratio a_mu\", \"Ratio a_sd\"),\n  Median = c(Median_LnRR, Median_LnCVR, Median_Ratio_a_mu, Median_Ratio_a_sd),\n  CI = c(CI_LnRR_p, CI_LnCVR_p, CI_Ratio_a_mu_p, CI_Ratio_a_sd_p),\n  pd = c(pd_LnRR$pd, pd_LnCVR$pd, pd_Ratio_a_mu$pd, pd_Ratio_a_sd$pd)\n) |> \n  mutate(\n    Median = round(Median, 3)\n  )\n\n# Results expressed as LnRR and LnCVR\ndf_res_Ln |> datatable(\n  options = list(\n    dom = 't',\n    autoWidth = TRUE,\n    columnDefs = list(\n      list(className = 'dt-left', targets = \"_all\")\n      )\n    ), \n  class=\"hover\"\n  ) \n```\n\n### Chains\n\nWe can check if the chains look good (@fig-chainsVI) and have a first look to the posterior distributions (@fig-postdistribVI).\n\n```{r chainspost, echo=T, message=F, warning=F}\n#| fig-cap: Parameters chains (without the first 1000 iterations of warmup).\n#| label: fig-chainsVI\n#| fig-height: 5\n#| fig-width: 8\n\nplot <-  \n  ggplot(\n    data = df_chains_post, \n    aes(\n      x = Iteration, \n      y = value, \n      color = Chain, \n      group = Chain\n      )\n  )+\n  geom_line(alpha=0.7)+\n  facet_wrap(~Parameter, scales = \"free\", ncol = 2)+\n  \n  scale_color_manual(values = nord(palette = \"frost\"))+\n  \n  theme_bw()+\n  theme(\n    legend.position = \"right\", \n    title=element_text(size=12, face=\"plain\"), \n    axis.title.x = element_text(face=\"plain\"),\n    strip.background = element_rect(fill=\"white\")\n    )\n\nplot\n\n```\n\n```{r savechains, include=F, message=F, warning=F}\n\nggsave(\n  filename=\"ModVI_post_chains.png\", \n  plot=plot, \n  width=8, height = 5, \n  path=here::here(\"fig/\")\n  )\n\nggsave(\n  filename=\"ModVI_post_chains.svg\", \n       plot=plot, \n  width=8, height = 5, \n  path=here::here(\"fig/\")\n  )\n```\n\nWe can also check on the parameters correlations (@fig-pairsVI).\n\n```{r, echo = T}\n#| fig-cap: Parameters correlations\n#| label: fig-pairsVI\n#| fig-height: 10\n#| fig-width: 10\n\nbayesplot::color_scheme_set(\"gray\")\np <- pairs(m.1.VI.post, regex=T)\np\n```\n\n```{r savecorr, include=F, message=F, warning=F}\n\nggsave(\n  filename=\"ModVI_post_corr.png\", \n  plot=p, \n  width=10, height = 10, \n  path=here::here(\"fig/\")\n  )\n\nggsave(\n  filename=\"ModVI_post_corr.svg\", \n       plot=p, \n  width=10, height = 10, \n  path=here::here(\"fig/\")\n  )\n\n```\n\n### Comparison of observed vs predicted data\n\n```{r dfpred, warning=F, message=F}\npred <- predicted_draws(m.1.VI.post, newdata=df_growth)\npost_i <- as.data.frame(posterior_summary(m.1.VI.post))\n\nID <- subset(df_growth, t==0)$ID\nexpo <- subset(df_growth, t==0)$exposition\n\ndf_estimates <- \n  data.frame(\n    ID                = ID,\n    exposition        = expo,\n    r_L0_i            = post_i$Estimate[8:(8+length(ID)-1)],\n    r_a_i_expo_0      = post_i$Estimate[(8+length(ID)):(8+length(ID)*2-1)],\n    r_a_i_expo_1      = post_i$Estimate[(8+length(ID)*2):(8+length(ID)*3-1)],\n    r_a_i_2.5_expo_0  = post_i$Q2.5[(8+length(ID)):(8+length(ID)*2-1)],\n    r_a_i_2.5_expo_1  = post_i$Q2.5[(8+length(ID)*2):(8+length(ID)*3-1)],\n    r_a_i_97.5_expo_0 = post_i$Q97.5[(8+length(ID)):(8+length(ID)*2-1)],\n    r_a_i_97.5_expo_1 = post_i$Q97.5[(8+length(ID)*2):(8+length(ID)*3-1)]\n    ) |> \n  mutate(\n    L0_i = post_i$Estimate[1]+r_L0_i,\n    a_i = case_when(\n      exposition == 0 ~ post_i$Estimate[2]+r_a_i_expo_0,\n      exposition == 1 ~ post_i$Estimate[3]+r_a_i_expo_1\n      ),\n    a_i_2.5 = case_when(\n      exposition==0 ~ post_i$Q2.5[2]+r_a_i_expo_0,\n      exposition==1 ~ post_i$Q2.5[3]+r_a_i_expo_1\n      ),\n    a_i_97.5 = case_when(\n      exposition==0 ~ post_i$Q97.5[2]+r_a_i_expo_0,\n      exposition==1 ~ post_i$Q97.5[3]+r_a_i_expo_1\n      )\n    ) |> \n  select(ID, exposition, L0_i, a_i, a_i_2.5, a_i_97.5)\n\ndf_pred_mean <- pred |> \n  aggregate(\n    .prediction ~ t + ID + exposition, \n    FUN=mean\n    )\n\ndf_pred_Q <- pred |> \n  aggregate(\n    .prediction ~ t + ID + exposition, \n    FUN='quantile', \n    probs=c(2.5, 97.5)/100\n    )\n\n\ndf_pred <- df_pred_mean |> \n  cbind(df_pred_Q$.prediction[,1]) |> \n  cbind(df_pred_Q$.prediction[,2]) |>\n  mutate(Expo=case_when(exposition==0 ~ \"Non exposed\",\n                        exposition==1 ~ \"Exposed\"))\n\ncolnames(df_pred) <- c(\"t\", \"ID\", \"exposition\", \n                       \"pred_L_mean\", \"pred_L_Q2.5\", \"pred_L_Q97.5\", \"Expo\")\n```\n\n```{r predobs, warning=F, message=F}\n#| fig-cap: Results of the model fit on experimental data. Predicted values are represented with points with their respective credibility interval of 95%. Red points correspond to the predicted value for exposed individuals and blue points for the non exposed individuals. Dashed and dotted lines represent the 1.5-folds and 2-fold changes, respectively. The full line represents the identity line. \n#| label: fig-predobsw\n#| fig-height: 13\n#| fig-width: 12\n\ndf_growth_ordered <- df_growth |> arrange(t) |> arrange(ID)\n\ndf_data_pred_obs <- df_pred |>\n  mutate(\n    w_obs = df_growth_ordered$w,\n    ratio_predobs = pred_L_mean^3 / w_obs\n    )\n\nfact_1 <- 1.5\nfact_2 <- 2\n\nseq_line <- seq(1.1, 600, 0.1)\n\ndf_line <- data.frame(\n  x1  = seq_line,\n  y1  = seq_line*fact_1,\n  x_1 = seq_line,\n  y_1 = seq_line/fact_1,\n  x2  = seq_line,\n  y2  = seq_line*fact_2,\n  x_2 = seq_line,\n  y_2 = seq_line/fact_2\n  )\n\nplot_predobs_log <- ggplot()+ \n  \n  geom_line(\n    data=df_line, \n    mapping=aes(x=x1, y=y1), \n    linetype=\"dashed\"\n    )+\n  geom_line(\n    data=df_line, \n    mapping=aes(x=x_1, y=y_1), \n    linetype=\"dashed\"\n    )+\n  geom_line(\n    data=df_line, \n    mapping=aes(x=x2, y=y2), \n    linetype=\"dotted\"\n    )+\n  geom_line(\n    data=df_line, \n    mapping=aes(x=x_2, y=y_2), \n    linetype=\"dotted\"\n    )+\n  geom_abline(intercept=0, slope=1)+\n  geom_pointrange(\n    data = df_data_pred_obs, \n    aes(\n      x=w_obs,\n      y=pred_L_mean^3,\n      ymin=pred_L_Q2.5^3,\n      ymax=pred_L_Q97.5^3, \n      color=Expo\n      ), \n    alpha=0.5\n    )+\n  \n  scale_x_log10(limits=c(1.6, 700))+\n  scale_y_log10(limits=c(1.6, 700))+\n  \n  scale_color_manual(values=rev(pal_col), name=\"\")+\n  scale_fill_manual(values=rev(pal_col), name=\"\")+\n  \n  labs(\n    x=\"Observed weight (mg)\", \n    y=\"Predicted weight (mg)\"\n    )+\n  \n  theme_minimal(24)+\n  theme(legend.position = \"bottom\")\n\nplot_predobs_log\n```\n\n```{r}\n#| tbl-cap: Percentage of points in the X-fold change area\n#| label: tbl-foldpred\n# Percentage of points in the X-fold change area\nf_fold <- function(fold){\n  res <- length(\n    subset(\n      df_data_pred_obs, \n      ratio_predobs < fold & ratio_predobs > -fold\n      )$w_obs\n    )/length(subset(df_data_pred_obs, !is.na(w_obs))$t)\n  return(res)\n}\n\ndf_fold <- data.frame(fold = c(1.1, 1.2, 1.25, 1.3, 1.5, 1.7, 2)) %>%\n  mutate(per = signif(mapply(f_fold, fold),2)*100)\n\ncolnames(df_fold) <- c(\"Fold\", \"Percentage of predictions within\")\n\ndf_fold |> datatable(options = list(dom = 't'), class=\"hover\")\n```\n\n::: panel-tabset\n## Non-exposed\n\n```{r, warning=F, message=F}\n#| fig-cap: Results of the model fit on experimental data. Predicted values are represented with points with their respective credibility interval of 95%. Red points correspond to the predicted value for exposed individuals and blue points for the non exposed individuals. Dashed and dotted lines represent the 1.5-folds and 2-fold changes, respectively. The full line represents the identity line. \n#| label: fig-predobswindctrl\n#| fig-height: 25\n#| fig-width: 10\n\n## Non-exposed\n\nplot_predobs_log_ind_ctrl_save <- ggplot()+ \n  \n  geom_line(\n    data=df_line, \n    mapping=aes(x=x1, y=y1), \n    linetype=\"dashed\"\n    )+\n  geom_line(\n    data=df_line, \n    mapping=aes(x=x_1, y=y_1), \n    linetype=\"dashed\"\n    )+\n  geom_line(\n    data=df_line, \n    mapping=aes(x=x2, y=y2), \n    linetype=\"dotted\"\n    )+\n  geom_line(\n    data=df_line, \n    mapping=aes(x=x_2, y=y_2), \n    linetype=\"dotted\"\n    )+\n  \n  geom_abline(intercept=0, slope=1)+\n  \n  geom_pointrange(\n    data = subset(df_data_pred_obs, exposition == 0), \n    aes(\n      x=w_obs,\n      y=pred_L_mean^3,\n      ymin=pred_L_Q2.5^3,\n      ymax=pred_L_Q97.5^3, \n      color=Expo\n      ), \n    alpha=0.5\n    )+\n  \n  facet_wrap(~ID, ncol=4)+\n  \n  scale_x_log10(limits=c(1.6, 700))+\n  scale_y_log10(limits=c(1.6, 700))+\n  \n  scale_color_manual(values=pal_col, name=\"\")+\n  scale_fill_manual(values=pal_col, name=\"\")+\n  \n  labs(\n    x=\"Observed weight (mg)\", \n    y=\"Predicted weight (mg)\"\n    )+\n  \n  theme_minimal(20)+\n  theme(\n    legend.position = \"bottom\",\n    axis.text=element_text(size=10)\n    )\nplot_predobs_log_ind_ctrl_save\n\n\n```\n\n## Exposed\n\n```{r, warning=F, message=F}\n#| fig-cap: Results of the model fit on experimental data. Predicted values are represented with points with their respective credibility interval of 95%. Red points correspond to the predicted value for exposed individuals and blue points for the non exposed individuals. Dashed and dotted lines represent the 1.5-folds and 2-fold changes, respectively. The full line represents the identity line. \n#| label: fig-predobswindtrt\n#| fig-height: 25\n#| fig-width: 10\n\n## Exposed\n\nplot_predobs_log_ind_trt_save <- ggplot()+ \n  \n  geom_line(\n    data=df_line, \n    mapping=aes(x=x1, y=y1), \n    linetype=\"dashed\"\n    )+\n  geom_line(\n    data=df_line, \n    mapping=aes(x=x_1, y=y_1), \n    linetype=\"dashed\"\n    )+\n  geom_line(\n    data=df_line, \n    mapping=aes(x=x2, y=y2), \n    linetype=\"dotted\"\n    )+\n  geom_line(\n    data=df_line, \n    mapping=aes(x=x_2, y=y_2), \n    linetype=\"dotted\"\n    )+\n  \n  geom_abline(intercept=0, slope=1)+\n  \n  geom_pointrange(\n    data = subset(df_data_pred_obs, exposition == 1), \n    aes(\n      x=w_obs,\n      y=pred_L_mean^3,\n      ymin=pred_L_Q2.5^3,\n      ymax=pred_L_Q97.5^3, \n      color=Expo\n      ), \n    alpha=0.5\n    )+\n  \n  facet_wrap(~ID, ncol=4)+\n  \n  scale_x_log10(limits=c(1.6, 700))+\n  scale_y_log10(limits=c(1.6, 700))+\n  \n  scale_color_manual(values=rev(pal_col), name=\"\")+\n  scale_fill_manual(values=rev(pal_col), name=\"\")+\n  \n  labs(\n    x=\"Observed weight (mg)\", \n    y=\"Predicted weight (mg)\"\n    )+\n  \n  theme_minimal(20)+\n  theme(\n    legend.position = \"bottom\",\n    axis.text=element_text(size=10)\n    )\nplot_predobs_log_ind_trt_save\n```\n:::\n\n```{r, include=F, message=F, warning=F}\nggsave(\n  filename=\"ModVI_predobs_weights.png\", \n  plot=plot_predobs_log, \n  width=12, height = 13, \n  path=here::here(\"fig/\")\n  )\n\nggsave(\n  filename=\"ModVI_predobs_weights_ind_ctrl.png\", \n  plot=plot_predobs_log_ind_ctrl_save, \n  width=10, height = 14, \n  path=here::here(\"fig/\"), \n  limitsize = FALSE\n  )\nggsave(\n  filename=\"ModVI_predobs_weights_ind_trt.png\", \n  plot=plot_predobs_log_ind_trt_save, \n  width=10, height = 14, \n  path=here::here(\"fig/\"), \n  limitsize = FALSE\n  )\n\nggsave(\n  filename=\"ModVI_predobs_weights.svg\", \n  plot=plot_predobs_log, \n  width=12, height = 10,\n  path=here::here(\"fig/\")\n  )\nggsave(\n  filename=\"ModVI_predobs_weights_ind_ctrl.svg\", \n  plot=plot_predobs_log_ind_ctrl_save, \n  width=10, height = 14, \n  path=here::here(\"fig/\"), \n  limitsize = FALSE\n  )\nggsave(\n  filename=\"ModVI_predobs_weights_ind_trt.svg\", \n  plot=plot_predobs_log_ind_trt_save, \n  width=10, height = 14, \n  path=here::here(\"fig/\"), \n  limitsize = FALSE\n  )\n```\n\n### Model predictions\n\nWe now check the predictions of the model at the population level (@fig-postpredVI) and the individual level (@fig-postpredVIindctrl & @fig-postpredVIindtrt) :\n\n```{r predmean, echo = T, warning=F}\n#| fig-cap: Posterior predictive check. Fresh body weight of non-exposed earthworms (blue points and thin lines, each line corresponding to one individual) and earthworms exposed to the equivalent of 3 RD of SwingÂ® Gold renewed each 28 days (red points and thin lines, each line corresponding to one individual). Colored ribbons correspond to the different credibility intervals for the mean growth for each cohort. The thicker black lines represent the predicted mean body weight.\n#| label: fig-postpredVI\n#| fig-height: 4\n#| fig-width: 8\n\ny_max <- 480\n\np_ctrl <- ggplot()+\n  \n  stat_lineribbon(\n    data = pred[pred$exposition == 0,],\n    aes(x=t, y=.prediction^3, group=exposition),\n    .width=c(.99,.95,.8,.5),\n    color=\"black\"\n    )+\n  geom_line(\n    data = df_growth[df_growth$exposition == 0,], \n    aes(x = t, y = L^3, group = ID), \n    color = \"#141c44\", \n    alpha = 0.4\n    )+\n  geom_point(\n    data = df_growth[df_growth$exposition == 0,], \n    aes(x = t, y = L^3, group = ID), color = \"#141c44\", alpha = 0.4\n    )+\n  \n  ylim(0, y_max)+\n  scale_x_continuous(\n    limits = c(0, 56),        \n    breaks = seq(0, 56, by = 28),        \n    minor_breaks = seq(0, 56, by = 14)\n  ) +\n  \n  scale_fill_manual(values = rev(pal_blue))+\n  \n  labs(y=\"Weight (mg)\", x=\"Time (days)\")+\n  \n  theme_minimal()+\n  theme(legend.position = \"none\")\n\np_trt <- ggplot()+\n  stat_lineribbon(\n    data = pred[pred$exposition == 1,], \n    aes(x=t, y = .prediction^3, group = exposition),\n    .width = c(.99,.95,.8,.5),\n    color = \"black\"\n    )+\n  geom_point(\n    data = df_growth[df_growth$exposition == 1,], \n    aes(x = t, y = L^3, group = ID), \n    color = \"#380000\", \n    alpha = 0.4\n    )+\n  geom_line(\n    data = df_growth[df_growth$exposition == 1,], \n    aes(x = t, y = L^3, group = ID), \n    color = \"#380000\", \n    alpha = 0.4\n    )+\n  \n  scale_x_continuous(\n    limits = c(0, 56),        \n    breaks = seq(0, 56, by = 28),        \n    minor_breaks = seq(0, 56, by = 14)\n  ) +\n  ylim(0, y_max)+\n  \n  \n  scale_fill_manual(values = rev(pal_red))+\n  \n  labs(y = \"Weight (mg)\", x = \"Time (days)\")+\n  \n  theme_minimal()+\n  theme(legend.position = \"none\")\n\nplot.estimates.grp <- p_ctrl + p_trt + \n  plot_layout(ncol=2, guides=\"collect\") & \n  theme(\n    legend.position = \"right\", \n    title=element_text(face=\"bold\"), \n    axis.title.x = element_text(face=\"plain\"),\n    axis.title.y = element_text(face=\"plain\")\n    )\n\nplot.estimates.grp\n```\n\n```{r savepredmeanpop, include=F, message=F, warning=F}\n\nggsave(\n  filename=\"ModVI_post_pred.png\", \n  plot=plot.estimates.grp, \n  width=8, height = 4.5, \n  path=here::here(\"fig/\")\n  )\n\nggsave(\n  filename=\"ModVI_post_pred.svg\", \n       plot=plot.estimates.grp, \n  width=8, height = 4.5, \n  path=here::here(\"fig/\")\n  )\n```\n\n::: panel-tabset\n## Non-exposed\n\n```{r predid, echo = T, warning=F}\n#| fig-cap: Posterior predictive check. Fresh body weight of non-exposed earthworms (blue points) and earthworms exposed to the equivalent of 3 RD of SwingÂ® Gold renewed each 28 days (red points). Colored ribbons correspond to the different credibility intervals for the predicted growth for each individual. The thicker black lines represent the predicted body weight.\n#| label: fig-postpredVIindctrl\n#| fig-height: 8\n#| fig-width: 9\n\np_ctrl <- ggplot()+\n  stat_lineribbon(\n    data = pred[pred$exposition==0,], \n    aes(x = t, y=.prediction^3, color=exposition, group=ID),\n    .width=c(.99,.95,.8,.5),\n    color=\"black\"\n    )+\n  geom_line(\n    data=df_growth[df_growth$exposition==0,], \n    aes(x=t, y=L^3, group=ID), \n    color=\"#141c44\", \n    alpha=0.25\n    )+\n  geom_point(\n    data=df_growth[df_growth$exposition==0,],\n    aes(x=t, y=L^3, group=ID), \n    color=\"#141c44\", \n    alpha=0.3, \n    size=2.5\n    )+\n  facet_wrap(~ID, ncol=5)+\n  \n  scale_fill_manual(values = rev(pal_blue))+\n  \n  labs(y=\"Weight (mg)\", x=\"Time (days)\")+\n  ylim(0, y_max)+\n  scale_x_continuous(\n    limits = c(0, 56),        \n    breaks = seq(0, 56, by = 28),        \n    minor_breaks = seq(0, 56, by = 14)\n  ) +\n  \n  theme_bw()+\n  theme(\n    legend.position = \"right\", \n    title=element_text(size=12, face=\"plain\"), \n    axis.title.x = element_text(face=\"plain\"),\n    strip.background = element_rect(fill=\"white\")\n    )\np_ctrl\n```\n\n## Exposed\n\n```{r, warning=F, message=F}\n#| fig-cap: Posterior predictive check. Fresh body weight of non-exposed earthworms (blue points) and earthworms exposed to the equivalent of 3 RD of SwingÂ® Gold renewed each 28 days (red points). Colored ribbons correspond to the different credibility intervals for the predicted growth for each individual. The thicker black lines represent the predicted body weight.\n#| label: fig-postpredVIindtrt\n#| fig-height: 8\n#| fig-width: 9\n\np_trt <- ggplot()+\n  stat_lineribbon(\n    data = pred[pred$exposition==1,],\n    aes(x = t, y=.prediction^3, color=exposition, group=ID),\n    .width=c(.99,.95,.8,.5),\n    color=\"black\"\n    )+\n  geom_point(\n    data=df_growth[df_growth$exposition==1,], \n    aes(x=t, y=L^3, group=ID), \n    color=\"#380000\", \n    alpha=0.3, \n    size=2.5\n    )+\n  geom_line(\n    data=df_growth[df_growth$exposition==1,], \n    aes(x=t, y=L^3, group=ID), \n    color=\"#380000\", \n    alpha=0.25\n    )+\n  facet_wrap(~ID, ncol=5, nrow=6)+\n  \n  scale_fill_manual(values = rev(pal_red))+\n  \n  labs(y=\"Weight (mg)\", x=\"Time (days)\")+\n  ylim(0, y_max)+\n  scale_x_continuous(\n    limits = c(0, 56),        \n    breaks = seq(0, 56, by = 28),        \n    minor_breaks = seq(0, 56, by = 14)\n  ) +\n  \n  theme_bw()+\n  theme(\n    legend.position = \"right\", \n    title=element_text(size=12, face=\"plain\"), \n    axis.title.x = element_text(face=\"plain\"),\n    strip.background = element_rect(fill=\"white\")\n    )\np_trt\n```\n:::\n\n```{r, include=F, message=F, warning=F}\nggsave(\n  filename=\"ModVI_post_pred_ind_trt.png\", \n  plot=p_trt, \n  width=12, height = 6.4, \n  path=here::here(\"fig/\")\n  )\nggsave(\n  filename=\"ModVI_post_pred_ind_ctrl.png\", \n  plot=p_ctrl, \n  width=12, height = 7.68, \n  path=here::here(\"fig/\")\n  )\n\nggsave(\n  filename=\"ModVI_post_pred_ind_trt.svg\", \n  plot=p_trt, \n  width=12, height = 6.4, \n  path=here::here(\"fig/\")\n  )\nggsave(\n  filename=\"ModVI_post_pred_ind_ctrl.svg\", \n  plot=p_ctrl, \n  width=12, height = 7.68, \n  path=here::here(\"fig/\")\n  )\n```\n\n## Individual parameters\n\n```{r, warning=F, message=F}\n#| fig-cap: Distribution of the individual parameters values. \n#| label: fig-postestimatesind\n#| fig-height: 6\n#| fig-width: 10\n\nplot_L0_i <- ggplot(data=df_estimates, aes(x=L0_i))+\n  \n  stat_dotsinterval(subguide = 'integer')+\n  geom_dotplot(\n    alpha=0.5, \n    dotsize =0.5,\n    width = 0.7,\n    binwidth = 0.05\n    )+\n  ylim(ymin=0, ymax=0.20)+\n  \n  labs(\n    x = bquote(\"Estimated initial volumetric structural length \" (mg^{1/3})), \n    y=\"\", \n    title=\"L0_i\")+\n  \n  theme_ggdist()\n\nplot_a_i <- ggplot(\n  data=df_estimates, \n  aes(x=a_i, color=exposition, fill=exposition)\n  )+\n  \n  stat_dotsinterval(subguide = 'integer')+\n  geom_dotplot(\n    alpha=0.5, \n    dotsize =0.7,\n    width = 0.7,\n    binwidth = 0.005\n    )+\n  \n  facet_wrap(~exposition, ncol=1)+\n  \n  ylim(ymin=0, ymax=0.05)+\n  \n  labs(\n    x = bquote(\"Estimated growth rate \" (mg^{1/3}/d)), \n    y=\"\", \n    title=\"a_i\"\n    )+\n  \n  scale_color_manual(values=pal_col)+\n  scale_fill_manual(values=pal_col)+\n  \n  theme_ggdist()+\n  theme(\n    legend.position = \"bottom\",\n    strip.background = element_rect(fill=\"white\"),\n    strip.text=element_blank()\n    )\n\ngrid.arrange(\n  plot_L0_i, \n  plot_a_i, \n  layout_matrix = cbind(c(1, NA),c(2, 2)))\n```\n\n```{r, warning=F, message=F}\n# Normality tests for the distribution of parameters\nshapiro.test(df_estimates$L0_i)\nshapiro.test(subset(df_estimates, exposition==0)$a_i)\nshapiro.test(subset(df_estimates, exposition==1)$a_i)\n```\n\n```{r diag, warning=F, message=F}\n#| fig-cap: Normality test for parameters' distributions. \n#| label: fig-qqplotailoi\n#| fig-height: 4\n#| fig-width: 8\n\ncol_diag <- Nord_polar[4]\n\nplot_QQ_L0 <- ggplot(mapping=aes(sample=df_estimates$L0_i))+\n  stat_qq(alpha=0.3,color=col_diag)+\n  stat_qq_line(color=col_diag)+\n  labs(x=\"Normal quantiles\", y=\"Residuals\", \n       title = bquote(bold(\"Initial structural length\")))+\n  theme_bw()\n\nplot_QQ_a_ctrl <- ggplot(\n  mapping=aes(\n    sample=subset(df_estimates, exposition==0)$a_i\n    )\n  )+\n  stat_qq(\n    alpha=0.3,\n    color=col_blue\n    )+\n  stat_qq_line(color=col_blue)+\n  labs(\n    x=\"Normal quantiles\", \n    y=\"Residuals\", \n    title=bquote(bold(\"Growth rate \" (mg^{1/3}/d))),\n    subtitle = \"Non-exposed\"\n       )+\n  theme_bw()\n\nplot_QQ_a_trt <- ggplot(\n  mapping=aes(\n    sample=subset(df_estimates, exposition==1)$a_i\n    )\n  )+\n  stat_qq(\n    alpha=0.3, \n    color=col_red\n    )+\n  stat_qq_line(color=col_red)+\n  labs(\n    x=\"Normal quantiles\", \n    y=\"Residuals\", \n    title=bquote(bold(\"Growth rate \" (mg^{1/3}/d))),\n    subtitle = \"Exposed\"\n    )+\n  theme_bw()\n\nplot <- plot_QQ_L0 + plot_QQ_a_ctrl + plot_QQ_a_trt + plot_layout(ncol=3)\nplot\n\n```\n\n```{r, include = F}\nt.test(subset(df_estimates, exposition ==0)$a_i, subset(df_estimates, exposition ==1)$a_i)\n```\n\n## Results summary\n\n```{r predtraj, warning=F, message=F}\n#| code-fold: show\n\n# Simulation of predicted trajectories\n\n# Times with weight measurements\nt_values <- seq(0, 56, 0.1)\n\n# Calculation of each earthworm weight at each time point\ndf_data_pred <- df_estimates |> \n  expand_grid(t = t_values) |>   \n  mutate(\n    L = L0_i + a_i * t\n    )\ndf_data_pred <- df_data_pred |> \n  mutate(\n    w = L^3,\n    exposition = case_when(\n      as.numeric(ID)<=30 ~ \"Non-exposed\",\n      as.numeric(ID)>30 ~ \"Exposed\")\n  )\n\ndf_data_pred$exposition <- factor(\n  df_data_pred$exposition, \n  levels = c(\"Non-exposed\", \"Exposed\")\n  )\n```\n\n```{r plotgrowthpred, warning=F, message=F}\n\nline_width <- 1.2\ny_max <- 550\nx_max <- 57\nfont_size <- 16\n\nplot_growth_pred <- ggplot()+\n  ylim(ymin=0, ymax=y_max)+\n  xlim(xmin=0, xmax=x_max)+\n  geom_line(\n    data=df_data_pred, \n    aes(\n      x=t, \n      y=w, \n      group=ID, \n      color=exposition\n      ), \n    alpha=1\n    )+\n  scale_color_manual(values=pal_col)+\n  scale_fill_manual(values=pal_col)+\n  facet_wrap(~exposition)+\n  scale_x_continuous(\n    limits = c(0, 56),        \n    breaks = seq(0, 56, by = 28),        \n    minor_breaks = seq(0, 56, by = 14)\n  ) +\n  labs(\n    x=\"Time (days)\", \n    y=\"Weight (mg)\",\n    title = \"A\"\n    )+ \n  theme_minimal(font_size+4)+\n  theme(\n    legend.position = \"top\", \n    legend.title=element_blank(), \n    plot.title=element_text(size=sizetitle*1.5, face=\"bold\"), \n    axis.title.x = element_text(face=\"plain\", size=font_size+2), \n    axis.title.y = element_text(face=\"plain\", size=font_size+2),\n    strip.background = element_blank(),\n    strip.text = element_blank(),\n    plot.margin = margin(b = 40,\n                         t=10,\n                         l=10,\n                         r=10)\n    )\n```\n\n```{r plotressum, warning=F, message=F}\n\ncol_delta <- Nord_polar[4]\nfont_size <- 16\nalpha_dens <- 0.6\nalpha_expo <- 0.4\n\nplot_res_mu <- ggplot(\n  data=subset(df_chains_post_long,Parameter %in% Param_a_mu), \n  aes(\n    #x=Parameter, \n    y=value,\n    color=exposition, \n    fill=exposition\n    )\n  )+\n  labs(\n    y=bquote(\"Mean growth rate \" (mg^{1/3}/d)),\n    title = \"B\"\n    )+\n  stat_halfeye(\n    adjust=0.5,\n    alpha=alpha_expo\n    )+\n  \n  scale_color_manual(values=rev(pal_col), name=\"\")+\n  scale_fill_manual(values=rev(pal_col), name=\"\")+\n  \n  theme_classic(font_size)+\n  theme(\n    plot.title=element_text(size=sizetitle*1.5, face=\"bold\"), \n    axis.line.x=element_blank(),\n    axis.title.x=element_blank(),\n    axis.ticks.x=element_blank(),\n    axis.text.x=element_blank(),\n    legend.position=\"none\",\n    plot.margin = margin(\n      b = 20,\n      t=20,\n      l=20,\n      r=20\n      )\n    )\n\nplot_res_sd <- ggplot(\n  data=subset(df_chains_post_long,Parameter %in% Param_a_sd), \n  aes(\n    #x=Parameter, \n    y=value, \n    color=exposition, \n    fill=exposition\n    )\n  )+\n  stat_halfeye(\n    adjust=0.5,\n    alpha=alpha_expo\n    )+\n  \n  scale_color_manual(values=rev(pal_col), name=\"\")+\n  scale_fill_manual(values=rev(pal_col), name=\"\")+\n  \n  labs(y=bquote(\n    \"Inter-idividual variation of growth rate \" (mg^{1/3}/d)\n    ),\n    title = \"C\"\n    )+\n  \n  theme_classic(font_size)+\n  theme(\n    plot.title=element_text(size=sizetitle*1.5, face=\"bold\"), \n    axis.line.x=element_blank(),\n    axis.title.x=element_blank(),\n    axis.ticks.x=element_blank(),\n    axis.text.x=element_blank(),\n    legend.position=\"none\",\n    plot.margin = margin(\n      b = 20,\n      t=20,\n      l=20,\n      r=20\n      )\n    )\n\nplot_res_mu_delta <- ggplot(\n  data=subset(df_chains_post_long,Parameter==\"Delta_a_mu\"), \n  aes(\n    #x=Parameter, \n    y=value\n    ), \n  color=col_delta, \n  fill=col_delta\n  )+\n  labs(y=\"Effect size\")+\n  stat_halfeye(\n    adjust=0.5, \n    alpha=alpha_expo\n    )+\n  geom_abline(\n    intercept=0, \n    slope=0, \n    color=col_delta, \n    linetype=\"dashed\"\n    )+\n  ylim(-0.025, 0.025)+\n  \n  scale_color_manual(values=rev(pal_col), name=\"\")+\n  scale_fill_manual(values=rev(pal_col), name=\"\")+\n  \n  theme_classic(font_size-2)+\n  theme(\n    axis.line.x=element_blank(),\n    axis.title.x=element_blank(),\n    axis.ticks.x=element_blank(),\n    axis.text.x=element_blank(),\n    legend.position=\"none\"\n    )\n\nplot_res_sd_delta <- ggplot(\n  data=subset(df_chains_post_long, Parameter==\"Delta_a_sd\"), \n  aes(\n    #x=Parameter, \n    y=value\n    ), \n  color=col_delta, \n  fill=col_delta\n  )+\n  labs(y=\"Effect size\")+\n  stat_halfeye(\n    adjust=0.5,\n    alpha=alpha_expo\n    )+\n  geom_abline(\n    intercept=0, \n    slope=0, \n    color=col_delta, \n    linetype=\"dashed\"\n    )+\n  ylim(-0.025, 0.025)+\n  \n  scale_color_manual(values=rev(pal_col), name=\"\")+\n  scale_fill_manual(values=rev(pal_col), name=\"\")+\n  \n  theme_classic(font_size-2)+\n  theme(\n    axis.line.x=element_blank(),\n    axis.title.x=element_blank(),\n    axis.ticks.x=element_blank(),\n    axis.text.x=element_blank(),\n    legend.position=\"none\"\n    )\n\nplot_res_mu_LnRR <- \n  ggplot(\n    data=subset(df_chains_post_long,Parameter==\"LnRR\"), \n    aes(\n      #x=Parameter, \n      y=value\n      ), \n    color=col_delta, \n    fill=col_delta\n    )+\n  \n  stat_halfeye(\n    adjust=0.5,\n    alpha=alpha_expo\n    )+\n  geom_abline(\n    intercept = 0, \n    slope = 0, \n    color = col_delta, \n    linetype = \"dashed\"\n    )+\n  annotate(\n    geom = \"text\", \n    x = 0.5, \n    y = 0.18, \n    label = paste(\"Median\\n =\", Median_LnRR_print),\n    size = 4.2\n    )+\n  \n  ylim(-0.25, 0.25)+\n  \n  scale_color_manual(values=rev(pal_col), name=\"\")+\n  scale_fill_manual(values=rev(pal_col), name=\"\")+\n  \n  labs(y=\"Effect size \\n(Ln RR)\")+\n  \n  theme_classic(font_size-3)+\n  theme(\n    axis.line.x=element_blank(),\n    axis.title.x=element_blank(),\n    axis.ticks.x=element_blank(),\n    axis.text.x=element_blank(),        \n    legend.position=\"none\"\n    )\n\nplot_res_sd_LnCVR <- \n  ggplot(\n    data=subset(df_chains_post_long, Parameter==\"LnCVR\"), \n    aes(\n      #x=Parameter, \n      y=value\n      ), \n    color=col_delta,\n    fill=col_delta\n    )+\n  \n  stat_halfeye(\n    adjust=0.5,\n    alpha=alpha_expo\n    )+\n  geom_abline(\n    intercept=0, \n    slope=0, \n    color=col_delta,\n    linetype=\"dashed\"\n    )+\n  annotate(\n    geom = \"text\", \n    x = 0.5, \n    y = -1.4, \n    label = paste(\"Median\\n =\", Median_LnCVR_print),\n    size = 4.2\n    )+\n  ylim(-2, 2)+\n  \n  scale_color_manual(values=rev(pal_col), name=\"\")+\n  scale_fill_manual(values=rev(pal_col), name=\"\")+\n  \n  labs(y=\"Effect size \\n(Ln CVi)\")+\n    \n  theme_classic(font_size-3)+\n  theme(\n    axis.line.x=element_blank(),\n    axis.title.x=element_blank(),\n    axis.ticks.x=element_blank(),\n    axis.text.x=element_blank(),\n    legend.position=\"none\"\n    )\n\nplot <- plot_res_mu + plot_res_sd + \n  plot_res_mu_delta + plot_res_sd_delta + \n  plot_res_mu_LnRR + plot_res_sd_LnCVR +\n  plot_layout(ncol=2, guides=\"collect\")\n\n```\n\n```{r plotressum, warning=F, message=F}\n#| fig-cap: Results summary. A) Estimated growth trajectories of non-exposed and exposed individuals (blue = non exposed, red = exposed). B) Comparison of the posterior distribution of the mean growth rate between the two cohorts and the corresponding effect size as the logarithm of the response ratio (Ln RR).  C) Comparison of the posterior distribution of the individual variation of growth rate between the two cohorts and the corresponding effect size as the logarithm of the coefficient of variation ratio (Ln CVi).\n#| label: fig-ressum\n#| fig-height: 12\n#| fig-width: 12\n\n# Results figure\nplot <- grid.arrange(\n  plot_growth_pred, \n  plot_res_mu, plot_res_sd,\n  plot_res_mu_LnRR, plot_res_sd_LnCVR,\n  ncol=6,\n    layout_matrix = cbind(\n    c(1, 1, 1, 2, 2, 2), \n    c(1, 1, 1, 2, 2, 2),\n    c(1, 1, 1, 2, 2, 2), \n    c(1, 1, 1, 2, 2, 2), \n    c(1, 1, 1, 2, 2, 2),\n    c(1, 1, 1, 4, NA, NA),\n    c(1, 1, 1, 4, NA, NA),\n    c(1, 1, 1, 3, 3, 3), \n    c(1, 1, 1, 3, 3, 3), \n    c(1, 1, 1, 3, 3, 3), \n    c(1, 1, 1, 3, 3, 3),\n    c(1, 1, 1, 3, 3, 3),\n    c(1, 1, 1, 5, NA, NA),\n    c(1, 1, 1, 5, NA, NA)\n    )\n  )\n\ngrid::grid.draw(plot)\n```\n\n```{r saveres, include=F}\nggsave(\n  filename=\"Test_summary_res.png\", \n  plot=plot, \n  width=12, height = 12, \n  path=here::here(\"fig/\")\n  )\nggsave(\n  filename=\"Test_summary_res.svg\", \n  plot=plot, \n  width=12, height = 12, \n  path=here::here(\"fig/\")\n  )\n```\n\n<button class=\"accordion-button\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#collapseOne\">\n\n<b> Session Information </b>\n\n</button>\n\n:::: {#collapseOne .accordion-collapse .collapse}\n<div>\n\n```{r}\nsessionInfo()\n```\n\n</div>\n::::\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":true,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"cache.path":"cache/","engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"../lightnord.theme","output-file":"D_Growth_modeling.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.40","bibliography":["../references/references.bib"],"csl":"../references/apa.csl","editor":{"markdown":{"canonical":true}},"code-block-bg":true,"code-block-border-left":"#E5E9F0","code-annotations":"select","theme":["cosmo","../html_css.scss"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}