{"title":"Can we ignore individual differences? Bias, type M and type S errors in OECD guidelines using a simulation study","markdown":{"headingText":"Can we ignore individual differences? Bias, type M and type S errors in OECD guidelines using a simulation study","containsRefs":false,"markdown":"```{r, include=F, warning=F, message=F}\nlibrary(tidyverse); library(here); library(ggthemes)\nlibrary(viridis); library(tidybayes); library(wesanderson)\nlibrary(ggdist); library(patchwork); library(extrafont)\n#library(scales); library(ggdist); library(ggsci)\nlibrary(parallel); library(deSolve); library(tmvtnorm)\nlibrary(fdrtool); library(readxl); library(here); library(easystats)\nlibrary(RColorBrewer); library(devtools); library(car); library(plotly)\nlibrary(knitr); library(Hmisc); library(nlstools); library(lsmeans)\nlibrary(ggpubr); library(gridExtra) ;\n#library(glmmTMB)\nlibrary(modelsummary);\nlibrary(plan); library(brms); library(ggmcmc); library(latex2exp);\nlibrary(reshape2); library(ggbreak); library(nord); library(ggtext); \nlibrary(kableExtra); library(DT)\n\nNord_frost <- nord(palette = \"frost\")\nNord_polar <- nord(palette = \"polarnight\")\nsizetitle <- 12\n\ncol_blue <- \"#5E81AC\"\ncol_red <- \"#f42404\"\npal_col <- c(col_blue, col_red)\n\npal_blue <- c(\"#5E81AC\", \"#7F9DC4\", \"#A0C1D9\", \"#DCE9F2\")\npal_red <- c(\"#f42404\", \"#F65E4B\", \"#F6876D\", \"#FBD3D0\")  \n```\n\n\nWe also sought to assess the accuracy of our inference if we had followed a typical biotest design for Environmental Risk Assessment (ERA). The standardized earthworm reproduction test of the OECD (TG nÂ°222), which also assesses growth effects, recommends four replicates per treatment and eight replicates for the control condition, with each replicate containing 10 earthworms. To simulate this design, we used the results of our growth model to generate growth data for 500 individuals. Using this simulated dataset, we performed a bootstrap procedure with 1,000 iterations. Each iteration corresponded to an experimental design adhering to the OECD TG 222 guidelines, where individuals were randomly assigned to replicates according to the recommended structure. This approach allowed us to estimate the variability and potential biases in parameter inference under the constraints of a typical ERA experimental design. This approach allowed us to calculate the Type M (magnitude) and Type S (sign) errors on the effect estimation, providing insights into the reliability and accuracy of the inferred parameters under the constraints of a typical ERA experimental design.\n\nThe R file used and the corresponding results are available in the `bootstrap` folder. The script ran on a Macbook Air M2 for about 12 hours.\n\nWe start by loading the results of our previous model with all the 30 replicates per groups for comparison :\n\n```{r, message=F, warning=F}\n#| tbl-cap: Results summary of the model with 30 individuals in each group\n#| label: tbl-resmod30ind\n#| code-fold: show\n\nm.30 <- brm(file=here::here(\"mod/m_brms_VI_post\"))\nres_30 <- as.data.frame(posterior_summary(m.30))\n\nL0_est30       <- res_30$Estimate[1]\na_ctrl_est30   <- res_30$Estimate[2]\na_trt_est30    <- res_30$Estimate[3]\nL0sd_est30     <- res_30$Estimate[4]\nasd_ctrl_est30 <- res_30$Estimate[5]\nasd_trt_est30  <- res_30$Estimate[6]\n\neffect_est30   <- a_trt_est30/a_ctrl_est30\neffectsd_est30 <- asd_trt_est30/asd_ctrl_est30\n\nres_show <- res_30[1:7,] |> \n  datatable(options = list(dom = 't'), class=\"hover\") \nres_show\n```\n\nWe can then load the results of the bootstrap :\n\n```{r}\n#| tbl-cap: 6 first line of the bootstrap result\n#| label: tbl-resOECDindboot\n#| code-fold: show\n\nload(file=here::here(\"bootstrap/Bootstrap_VI_OECD_seed121212_28j_f.RData\"))\n\ndf_draws <- res_f\n\ndf_draws_show <- df_draws[1:4] |> \n  datatable(options = list(dom = 't'), class=\"hover\", rownames=FALSE) \ndf_draws_show\n```\n\nFinally, we can calculate the parameter estimation errors for all iterations.\n\n```{r errcalc}\ndf_draws_f <- df_draws %>%\n  mutate(\n    err_L0              = (L0_est30-L0_est)/L0_est30,\n    err_a_ctrl          = (a_ctrl_est-a_ctrl_est30)/a_ctrl_est30,\n    err_a_trt           = (a_trt_est-a_trt_est30)/a_trt_est30,\n    effect              = a_trt_est/a_ctrl_est,\n    err_effect          = (effect-effect_est30)/effect_est30,\n    err_L0sd            = (L0sd_est-L0sd_est30)/L0sd_est30,\n    err_asd_ctrl        = (asd_ctrl_est-asd_ctrl_est30)/asd_ctrl_est30,\n    err_asd_trt         = (asd_trt_est-asd_trt_est30)/asd_trt_est30,\n    effectsd            = asd_trt_est/asd_ctrl_est,\n    err_effectsd        = (effectsd-effectsd_est30)/effectsd_est30,\n    bol_contrary_ccl_mu = (a_trt_est>a_ctrl_est),\n    bol_contrary_ccl_sd = (asd_trt_est<asd_ctrl_est)\n  )\n```\n\n```{r, warning=F, message=F}\n#| fig-cap: Error percentage on the different model parameters and the estimated effect on mean growth rate and its individual variation obtained with a bootstrap (n = 1000) with 8 or 4 replicates for the non-exposed and exposed conditions respectively (type M errors). One replicate represents 10 randomly chosen individuals. The bin width for estimated means and the error on the estimated individual variations are 5% and 15% respectively. The median of the distributions are 3.7% and 16.3% respectively. \n#| label: fig-errOECDboot\n#| fig-height: 10\n#| fig-width: 6\n\nalpha_stat <- 0.7\nalpha_expo <- 0.3\nlinevertic <- 1.2\nalpha_dens <- 0.5\n\nx_min_err    <- -0.3*100\nx_max_err    <- -x_min_err\nx_min_errsd  <- -4.4*100\nx_max_errsd  <- -x_min_errsd\nbin_width    <- 0.05*100\nbin_width_sd <- 0.15*100\n\nsizetitle <- 10\n\nplot_L0 <- ggplot(\n  data=df_draws_f, \n  aes(x=err_L0*100)\n  )+\n  geom_histogram(\n    binwidth=bin_width,\n    color=Nord_polar[4], \n    fill = Nord_polar[4], \n    alpha=alpha_expo\n    )+\n  geom_vline(\n    xintercept = 0, , \n    linetype=\"dashed\"\n    )+\n  xlim(\n    x_min_err, \n    x_max_err\n    )+\n  labs(\n    x=TeX(r\"( Error on $L0_{\\mu}$ (%) )\"), \n    y=\"\"\n    )+\n  theme_bw(sizetitle)\n\nplot_a_ctrl <- ggplot(\n  data=df_draws_f, \n  aes(x=err_a_ctrl*100)\n  )+\n  geom_histogram(\n    binwidth=bin_width,\n    color=pal_col[1], \n    fill = pal_col[1], \n    alpha=alpha_expo\n    )+\n  geom_vline(\n    xintercept = 0, \n    linetype=\"dashed\"\n    )+\n  labs(\n    x=TeX(r\"( Error on $a_{non\\ exposed,\\mu}$ (%) )\"), \n    y=\"\"\n    )+\n  xlim(\n    x_min_err, \n    x_max_err\n    )+\n  theme_bw(sizetitle)\n\nplot_a_trt <- ggplot(\n  data=df_draws_f, \n  aes(x=err_a_trt*100)\n  )+\n  geom_histogram(\n    binwidth=bin_width,\n    color=pal_col[2], \n    fill = pal_col[2], \n    alpha=alpha_expo\n    )+\n  geom_vline(\n    xintercept = 0, \n    linetype=\"dashed\"\n    )+\n  labs(\n    x=TeX(r\"( Error on $a_{exposed,\\mu}$ (%) )\"), \n    y=\"\"\n    )+\n  xlim(\n    x_min_err, \n    x_max_err\n    )+\n  theme_bw(sizetitle)\n\nplot_effect <- ggplot(\n  data=df_draws_f, \n  aes(x=err_effect*100)\n  )+\n  geom_histogram(\n    binwidth=bin_width,\n    color=Nord_polar[1], \n    fill = Nord_polar[1], \n    alpha=alpha_expo\n    )+\n  geom_vline(\n    xintercept = 0, \n    linetype=\"dashed\"\n    )+\n  labs(\n    x=bquote(\"Error on the estimated mean effect (%)\"), \n    y=\"\"\n    )+\n  xlim(\n    x_min_err, \n    x_max_err\n    )+\n  theme_bw(sizetitle)\n\nplot_L0sd <- ggplot(\n  data=df_draws_f, \n  aes(x=err_L0sd*100)\n  )+\n  geom_histogram(\n    binwidth=bin_width_sd,\n    color=Nord_polar[4], \n    fill = Nord_polar[4], \n    alpha=alpha_expo\n    )+\n  geom_vline(\n    xintercept = 0, \n    linetype=\"dashed\"\n    )+\n  labs(\n    x=TeX(r\"( Error on $L0_{\\sigma}$ (%) )\"), \n    y=\"\"\n    )+\n  xlim(\n    x_min_errsd, \n    x_max_errsd\n    )+\n  theme_bw(sizetitle)\n\nplot_asd_ctrl <- ggplot(\n  data=df_draws_f, \n  aes(x=err_asd_ctrl*100)\n  )+\n  geom_histogram(\n    binwidth=bin_width_sd,\n    color=pal_col[1], \n    fill = pal_col[1], \n    alpha=alpha_expo\n    )+\n  geom_vline(\n    xintercept = 0, \n    linetype=\"dashed\"\n    )+\n  labs(\n    x=TeX(r\"( Error on $a_{non\\ exposed,\\sigma}$ (%) )\"), \n    y=\"\"\n    )+\n  xlim(\n    x_min_errsd, \n    x_max_errsd\n    )+\n  theme_bw(sizetitle)\n\nplot_asd_trt <- ggplot(\n  data=df_draws_f, \n  aes(x=err_asd_trt*100)\n  )+\n  geom_histogram(\n    binwidth=bin_width_sd,\n    color=pal_col[2], \n    fill = pal_col[2], \n    alpha=alpha_expo\n    )+\n  geom_vline(\n    xintercept = 0,\n    linetype=\"dashed\"\n    )+\n  labs(\n    x=TeX(r\"( Error on $a_{exposed,\\sigma}$ (%) )\"), \n    y=\"\"\n    )+\n  xlim(\n    x_min_errsd, \n    x_max_errsd\n    )+\n  theme_bw(sizetitle)\n\nplot_effectsd <- ggplot(\n  data=df_draws_f, \n  aes(x=err_effectsd*100)\n  )+\n  geom_histogram(\n    binwidth=bin_width_sd,\n    color=Nord_polar[1], \n    fill = Nord_polar[1], \n    alpha=alpha_expo\n    )+\n  geom_vline(\n    xintercept = 0,\n    linetype=\"dashed\"\n    )+\n  labs(\n    x=bquote(\"Error on the estimated effect\\n on individual variation (%)\"), \n    y=\"\"\n    )+\n  xlim(\n    x_min_errsd, \n    x_max_errsd\n    )+\n  theme_bw(sizetitle)\n\nplot <- plot_L0 + plot_L0sd + plot_a_ctrl + plot_asd_ctrl+ plot_a_trt+ plot_asd_trt + plot_effect + plot_effectsd +\n  plot_layout(\n    ncol=2, \n    guides=\"collect\"\n    ) & \n  theme(\n    legend.position = \"right\", \n    title=element_text(size=sizetitle, face=\"bold\"), \n    axis.title.x = element_text(face=\"plain\")\n    )\nplot\n```\n\n```{r, include=F}\nggsave(\n  filename=\"Bootstrap_OECD_res_err.png\", \n  plot=plot, \n  width=6, \n  height = 10, \n  path=here::here(\"fig/\")\n  )\n```\n\n```{r}\n#| tbl-cap: Statistical summary of the parameters distributions (in % or error)\n#| label: tbl-resOECDsummary\n\ndf_res_draws <- df_draws_f %>%\n  pivot_longer(\n    cols = -ID_draws, # Garde ID_draws intact\n    names_to = \"variable\",\n    values_to = \"value\"\n  ) %>%\n  group_by(variable) %>%\n  summarise(\n    median = median(value)*100,\n    mean = mean(value)*100,\n    Q2.5 = quantile(value, 0.025)*100,\n    Q97.5 = quantile(value, 0.975)*100\n  )\n\nselected_var <- c(\"err_L0\", \"err_a_ctrl\", \"err_a_trt\", \"err_L0sd\", \"err_asd_ctrl\", \"err_asd_trt\", \"err_effect\", \"err_effectsd\")\n\ndf_res_draws <- df_res_draws |> \n  filter(variable %in% selected_var)\n\ndf_res_draws_show <- df_res_draws |> datatable(\n  options = list(dom = 't'), \n  class=\"hover\"\n  ) |> \n  formatRound(columns = 2:length(df_res_draws), digits = 2)\ndf_res_draws_show\n\nmean_err_effect <- round(subset(df_res_draws, variable == \"err_effect\")$mean,2)\nmean_err_effectsd <- round(subset(df_res_draws, variable == \"err_effectsd\")$mean,2)\n  \n```\n\n```{r}\n#| tbl-cap: Percentage of iteration for which the error on the different model parameters and effects on mean growth rate and its individual variation is inferior to the given x value. \n#| label: tbl-resOECDind\n\nx = c(.05,.10,.25, .50, .75, .90, .95, 1, 2, 3, 4)\n\ndf_err <- data.frame(x = x) %>%\n  mutate(\n    L0       = map_dbl(x, ~ sum(abs(df_draws_f$err_L0) <= .x) / 1000*100),\n    a_ctrl   = map_dbl(x, ~ sum(abs(df_draws_f$err_a_ctrl) <= .x) / 1000*100),\n    a_trt    = map_dbl(x, ~ sum(abs(df_draws_f$err_a_trt) <= .x) / 1000*100),\n    asd_ctrl = map_dbl(x, ~ sum(abs(df_draws_f$err_asd_ctrl) <= .x) / 1000*100),\n    asd_trt  = map_dbl(x, ~ sum(abs(df_draws_f$err_asd_trt) <= .x) / 1000*100),\n    effect   = map_dbl(x, ~ sum(abs(df_draws_f$err_effect) <= .x) / 1000*100),\n    effectsd = map_dbl(x, ~ sum(abs(df_draws_f$err_effectsd) <= .x) / 1000*100)\n  )\n\nl_df_err <- length(df_err)\n\ndf_err_show <- df_err |> \n  datatable(\n    options = list(dom = 't'), \n    class=\"hover\", \n    rownames=FALSE\n    )  |> \n  formatRound(columns = 1:length(df_err), digits = 2)\n\ndf_err_show\n\nPer_sample_err_effect_5 <- subset(df_err, x == 0.05)$effect\nPer_sample_err_effect_10 <- subset(df_err, x == 0.10)$effect\nnb_err_effectsd_sup100 <- (100-subset(df_err, x == 1.0)$effectsd)/100*1000\n```\n\n```{r typeS}\nCount_mu_higher_in_exposed <- length(subset(df_draws_f, bol_contrary_ccl_mu==TRUE)$ID_draws)\nCount_sd_lower_in_exposed <- length(subset(df_draws_f, bol_contrary_ccl_sd==TRUE)$ID_draws)\n\nPer_contrary_ccl_mu <- Count_mu_higher_in_exposed/1000*100\nPer_contrary_ccl_sd <- Count_sd_lower_in_exposed/1000*100\n```\n\nWhen compared to our experimental design using 30 individuals, the results of this bootstrap indicate that the population-level effect would still be well estimated with deviations not exceeding Â±5% and 10% in `r Per_sample_err_effect_5`% and `r Per_sample_err_effect_10`% of the samples, respectively, but with an average overestimation of `r mean_err_effect`%. However, estimating individual-level variability proved much more challenging, with errors reaching up to 200% in `r nb_err_effectsd_sup100` samples. This suggests that the variation in growth rate among individuals would likely be poorly captured, with the effect often underestimated by approximately 50%, and in some cases, overestimated by more than 200%. We also note that the direction of the effect was misestimated in `r Per_contrary_ccl_mu`% of cases for the mean effect and `r Per_contrary_ccl_sd`% for individual variation (type S error).\n\nThese simulations of an OECD protocol identified important limitations of simplified traditional approaches, particularly in tests with a single control and one concentration. By simulating fewer replicates with measurements at the replicate scale, we demonstrated that small studies may fail to capture the full range of inter-individual differences and, in some cases, increase the risk of misinterpreting the direction of a substanceâs effect. For example, in a hypothetical scenario of a simplified design of the OECD earthworm reproduction test with only one concentration tested, estimation errors could have led to incorrect conclusions about the effect direction in a non negligible percentage of cases, suggesting a beneficial effect. These results raise concerns about the robustness of underpowered studies with limited replicates and tested doses for environmental risk assessment, emphasizing the value of adequately sized experiments to improve the reliability of conclusions.\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":true,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"cache.path":"cache/","engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"../lightnord.theme","output-file":"E_Less_replicates.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.40","bibliography":["../references/references.bib"],"csl":"../references/apa.csl","editor":{"markdown":{"canonical":true}},"code-block-bg":true,"code-block-border-left":"#E5E9F0","code-annotations":"select","theme":["cosmo","../html_css.scss"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}